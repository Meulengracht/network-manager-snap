summary: Verify that netplan configuration files are immutable

execute: |
    # TODO remove when we can run tests on UC20
    # (netplan .nmconnection issues, snapd mountspace issues)
    exit 0
    # Ensure we're using a configuration generated from netplan
    test -e /etc/netplan/00-snapd-config.yaml
    test -e /run/NetworkManager/system-connections/netplan-eth0

    /snap/bin/network-manager.nmcli c | MATCH 'netplan.eth0.*eth0'
    # Try to change the DNS server used on this connection
    test ! `/snap/bin/network-manager.nmcli c modify netplan-eth0 ipv4.dns 8.8.8.8`
