summary: Verify that netplan configuration files are immutable

execute: |
    . $TESTSLIB/utilities.sh
    get_qemu_eth_iface eth_if

    # Ensure we're using a configuration generated from netplan
    test -e /etc/netplan/00-snapd-config.yaml
    # Current netplan plugin removes these files. TODO put back when new plugin is ready
    #test -e /run/NetworkManager/system-connections/netplan-$eth_if.nmconnection

    /snap/bin/network-manager.nmcli c | MATCH "System 00-snapd-config.yaml.*$eth_if"
    # Try to change the DNS server used on this connection
    test ! $(/snap/bin/network-manager.nmcli c modify 'System 00-snapd-config.yaml' ipv4.dns 8.8.8.8)
